# ═══════════════════════════════════════════════════════════════════════════════
# Test MQTT Broker Configuration - Adapted from Devcontainer
# ═══════════════════════════════════════════════════════════════════════════════
# Based on proven devcontainer/mosquitto/mosquitto.conf with test optimizations
# ═══════════════════════════════════════════════════════════════════════════════

# =================================================================
# Listeners - Same as devcontainer
# =================================================================
listener 1883

# =================================================================
# Persistence - Disabled for testing (clean state)
# =================================================================
# Note: Devcontainer has persistence true, but for tests we want clean state
persistence false

# =================================================================
# Logging - Enhanced for test debugging
# =================================================================
log_dest stdout
log_type error
log_type warning
log_type notice
log_type information
log_type subscribe
log_type unsubscribe
connection_messages true
log_timestamp true

# =================================================================
# Security - Simplified for testing
# =================================================================
# Use password file (same approach as devcontainer)
password_file /mosquitto/config/passwd

# =================================================================
# Performance - Optimized for testing
# =================================================================
# Keep alive settings optimized for test reliability
max_inflight_messages 20
max_queued_messages 100
max_connections 100

# Disable retained messages for clean test state
retain_available false

# =================================================================
# Test-specific optimizations
# =================================================================
# Faster timeouts for test reliability
sys_interval 5
autosave_interval 0
queue_qos0_messages false
