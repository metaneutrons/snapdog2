#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

## SnapDog2 Pre-commit Hook
## Runs dotnet format and build only when code files are changed

# Check if any code files are being committed
code_files_changed=$(git diff --cached --name-only | grep -E '\.(cs|csproj|props|targets|sln|config|json)$' || true)

if [ -n "$code_files_changed" ]; then
    echo 'ğŸ¨ Code files detected. Checking formatting with dotnet format...'
    
    dotnet format --verbosity diagnostic
    format_exit_code=$?

    if [ $format_exit_code -eq 0 ]; then
        echo "âœ… Code formatting verified."
    else
        echo "âŒ Failed to format code. Please check for syntax errors."
        exit 1
    fi

    echo "ğŸ—ï¸ Building project..."
    dotnet build --verbosity quiet

    if [ $? -ne 0 ]; then
        echo "âŒ Build failed. Please fix errors before committing."
        exit 1
    fi

    echo "âœ… Pre-commit checks passed!"
else
    echo "ğŸ“ Only documentation/config files changed. Skipping build checks."
fi
