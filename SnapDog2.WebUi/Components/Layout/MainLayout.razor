@inherits LayoutComponentBase
@inject IJSRuntime JSRuntime

<div class="theme-toggle" @onclick="ToggleTheme">
    @(isDarkMode ? "‚òÄÔ∏è" : "üåô")
</div>

<main>
    @Body
</main>

@code {
    private bool isDarkMode = false;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            // Check system preference
            isDarkMode = await JSRuntime.InvokeAsync<bool>("matchMedia", "(prefers-color-scheme: dark)");
            await UpdateTheme();
            StateHasChanged();
        }
    }

    private async Task ToggleTheme()
    {
        isDarkMode = !isDarkMode;
        await UpdateTheme();
    }

    private async Task UpdateTheme()
    {
        var theme = isDarkMode ? "dark" : "light";
        await JSRuntime.InvokeVoidAsync("eval", $"document.documentElement.setAttribute('data-theme', '{theme}')");
    }
}
